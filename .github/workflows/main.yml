name: build

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build-nixos:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Build for supported platforms on NixOS
        run: docker-compose run build-nixos
  build-archlinux:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Build for supported platforms on Arch Linux
        run: docker-compose run build-archlinux
  build-ubuntu:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Build for supported platforms on Ubuntu
        run: docker-compose run build-ubuntu
  build-windows:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v2
        with:
          submodules: recursive
      - uses: ilammy/msvc-dev-cmd@v1
      - name: Install SCons software construction tool
        run: choco install python3 && python -m pip install scons
      - name: Build for Windows 64-bit using MSVC
        run: |
          cd addons/godot_xterm/native/external/godot-cpp
          scons platform=windows target=release bits=64 generate_bindings=yes
          cd ../../
          scons platform=windows target=release bits=64
      - uses: actions/upload-artifact@v2
        with:
          name: bin
          path: addons/godot_xterm/native/bin/*.dll
